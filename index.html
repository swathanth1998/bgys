<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bicep Guys - Interactive Menu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f8f8; /* Lighter background */
            color: #333333; /* Darker text for contrast */
        }
        .font-bebas {
            font-family: 'Bebas Neue', sans-serif;
        }
        .gradient-text {
            background: linear-gradient(90deg, #FDB813, #FFAA00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .selected-btn {
            background-color: #FDB813 !important;
            color: #1a1a1a !important;
            border-color: #FDB813 !important;
        }
        .selected-nav-button {
            background-color: #FDB813 !important;
            color: #1a1a1a !important;
            border-color: #FDB813 !important;
            box-shadow: 0 4px 14px 0 rgba(253, 184, 19, 0.4);
        }
        .section-hidden {
            display: none;
        }
        /* Permanent image display */
        .kebab-image-wrapper {
            height: 10rem; /* Fixed height for permanent display */
            opacity: 1; /* Always visible */
            overflow: hidden;
            margin-bottom: 1rem; /* Consistent margin */
            transition: transform 0.3s ease-in-out; /* Add subtle hover effect */
        }
        .kebab-card:hover .kebab-image-wrapper {
            transform: scale(1.03); /* Slightly zoom on hover */
        }
        /* Custom styles for logo image */
        .header-logo {
            max-height: 150px; /* Adjust as needed */
            width: auto;
        }
        @media (min-width: 768px) {
            .header-logo {
                max-height: 200px; /* Larger on desktop */
            }
        }
        /* Card styling adjustments for light theme */
        .bg-card-light {
            background-color: #ffffff; /* White card background */
            border: 1px solid #e0e0e0; /* Subtle border */
        }
        .text-card-dark {
            color: #333333; /* Dark text for cards */
        }

        /* Modal specific styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: #1a1a1a;
            padding: 2rem;
            border-radius: 0.5rem;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            color: #f1f1f1;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .modal-image-preview {
            width: 100px; /* Fixed width for modal images */
            height: 100px; /* Fixed height for modal images */
            object-fit: contain; /* Ensure image fits */
            margin-left: 1rem;
            border-radius: 0.25rem;
        }
    </style>
</head>
<body>

    <header class="text-center py-8 relative bg-white shadow-md">
        <img src="images/ChatGPT Image May 31, 2025, 12_08_18 PM.jpg" alt="Bicep Guys Fast Food Kebabs Logo" class="mx-auto header-logo object-contain mb-2">
        <p class="mt-2 text-xl text-gray-700">Fuel Your Goals, Deliciously. Always Guilt-Free. No Seed Oils.</p>
        <nav class="mt-6">
            <button id="nav-menu" class="nav-button font-bebas text-2xl tracking-wide py-2 px-6 mx-3 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors duration-300 text-gray-800 selected-nav-button">Menu</button>
            <button id="nav-about" class="nav-button font-bebas text-2xl tracking-wide py-2 px-6 mx-3 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors duration-300 text-gray-800">About Us</button>
            <button id="nav-cart" class="nav-button font-bebas text-2xl tracking-wide py-2 px-6 mx-3 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors duration-300 text-gray-800">Cart (<span id="cart-count">0</span>)</button>
        </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-24">

        <section id="menu-section">
            <div id="menu-intro" class="text-center mb-12 pt-12">
                <h2 class="font-bebas text-5xl tracking-wide mb-4 text-gray-800">Craft Your Power Entree</h2>
                <p class="max-w-3xl mx-auto text-lg text-gray-600">
                    Welcome to America's first absolutely **Guilt-Free Binge Eating Destination!** Dive into our menu crafted for deliciousness, health, and balanced macros. Every kebab comes with your choice of rice and a nutrient-packed veggie bowl.
                </p>
            </div>

            <h3 class="font-bebas text-4xl tracking-wide text-yellow-600 text-center mb-8">Signature Kebabs</h3>
            <div id="filter-container" class="flex flex-wrap justify-center gap-3 mb-10">
            </div>

            <div id="kebab-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            </div>

            <h3 class="font-bebas text-4xl tracking-wide text-yellow-600 text-center mt-20 mb-8">Power-Up Sides & Hydration</h3>
            <div id="sides-drinks-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div id="sauces-section-standalone" class="bg-card-light rounded-lg shadow-lg p-6 border">
                    <h4 class="font-bebas text-3xl gradient-text mb-4 text-center">Guilt-Free Sauces</h4>
                    <div id="sauce-grid-sides" class="grid grid-cols-2 gap-4"></div>
                </div>
                <div id="shakes-section" class="bg-card-light rounded-lg shadow-lg p-6 border">
                    <h4 class="font-bebas text-3xl gradient-text mb-4 text-center">Protein Shakes</h4>
                    <div id="shake-grid" class="grid grid-cols-1 gap-4"></div>
                </div>
                <div id="yogurts-sodas-section" class="bg-card-light rounded-lg shadow-lg p-6 border">
                    <h4 class="font-bebas text-3xl gradient-text mb-4 text-center">Yogurts & Zero Sugar Drinks</h4>
                    <div id="yogurt-grid" class="grid grid-cols-1 gap-4 mb-4"></div>
                    <div id="soda-grid" class="grid grid-cols-1 gap-4"></div>
                </div>
            </div>
        </section>

        <section id="about-section" class="section-hidden py-12">
            <h2 class="font-bebas text-5xl tracking-wide text-center mb-10 gradient-text">Our Story: Fueling Your Ambition</h2>
            <div class="max-w-4xl mx-auto text-lg text-gray-700 space-y-8">
                <p>
                    At Bicep Guys, we saw a glaring gap in the fast-food world: delicious, genuinely healthy, and high-protein options that truly fit a fitness-focused lifestyle. We're here to redefine fast food, making it synonymous with **taste, health, and balanced nutrition.** Our vision is simple yet powerful: to become the ultimate go-to fuel station for anyone serious about their health, their gains, and their goals. We firmly believe that convenience should never come at the cost of your well-being or flavor.
                </p>
                <p>
                    This is America's first **absolutely Guilt-Free Binge Eating Destination!** Yes, you read that right. Here, "binge eating" means indulging without a shred of remorse, knowing that every single bite is packed with purposeful nutrition. Every meal at Bicep Guys is crafted with meticulous care: we prioritize lean, premium proteins, sourced responsibly, and paired with vibrant, garden-fresh vegetables that burst with natural goodness. You won't find any hidden seed oils or questionable additives in our kitchen â€“ our unwavering commitment is to clean, wholesome, and transparent ingredients. Our kebabs are legendary for being juicy, incredibly flavorful, and perfectly macro-friendly, so hitting your protein targets feels like a delicious reward.
                </p>
                <p>
                    Whether you're a seasoned gym enthusiast meticulously tracking your macros, a busy professional striving for clean eating amidst a hectic schedule, or just someone looking for genuinely healthy fast food that tastes amazing, Bicep Guys is built for you. We're more than just a restaurant; we're a community dedicated to empowering your healthy lifestyle. Join us and discover how easy and utterly delicious hitting your protein goals can truly be. Your journey to a stronger, healthier, and happier you starts right here, with food you can truly feel good about.
                </p>
            </div>
        </section>

        <section id="cart-section" class="section-hidden py-12">
            <h2 class="font-bebas text-5xl tracking-wide text-center mb-10 gradient-text">Your Power Cart</h2>
            <div id="cart-items-container" class="max-w-3xl mx-auto bg-card-light rounded-lg shadow-lg p-6 space-y-4 border">
                <p id="empty-cart-message" class="text-center text-gray-600">Your cart is empty. Time to load up on some gains!</p>
            </div>
            <div class="max-w-3xl mx-auto mt-6 p-4 bg-card-light rounded-lg shadow-lg flex justify-between items-center font-bebas text-3xl border">
                <span>Total:</span>
                <span id="cart-total">$0.00</span>
            </div>
            <div class="max-w-3xl mx-auto mt-6 flex flex-wrap justify-center gap-4">
                <button id="checkout-button" class="font-bebas text-2xl py-3 px-8 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300">Proceed to Checkout</button>
                <button id="clear-cart-button" class="font-bebas text-2xl py-3 px-8 rounded-full bg-red-600 text-white hover:bg-red-500 transition-colors duration-300">Clear Cart</button>
            </div>
        </section>

        <section id="checkout-section" class="section-hidden py-12">
            <h2 class="font-bebas text-5xl tracking-wide text-center mb-10 gradient-text">Checkout</h2>
            <div id="checkout-summary" class="max-w-3xl mx-auto bg-card-light rounded-lg shadow-lg p-6 space-y-4 border">
                <h3 class="font-bebas text-3xl text-yellow-600 mb-4">Order Summary</h3>
                <div id="checkout-items" class="space-y-2 text-gray-700">
                </div>
                <div class="border-t border-gray-300 pt-4 mt-4 font-bebas text-3xl flex justify-between">
                    <span>Order Total:</span>
                    <span id="checkout-total-summary">$0.00</span>
                </div>
                <div class="border-t border-gray-300 pt-4 mt-4 text-lg">
                    <h4 class="font-bebas text-2xl text-yellow-600 mb-2">Nutritional Summary:</h4>
                    <p>Total Protein: <span id="checkout-total-p" class="font-bold">0g</span></p>
                    <p>Total Carbs: <span id="checkout-total-c" class="font-bold">0g</span></p>
                    <p>Total Fats: <span id="checkout-total-f" class="font-bold">0g</span></p>
                    <p>Total Calories: <span id="checkout-total-cal" class="font-bold">0</span></p>
                </div>
            </div>

            <div class="max-w-3xl mx-auto mt-8 bg-card-light rounded-lg shadow-lg p-6 border">
                <h3 class="font-bebas text-3xl text-yellow-600 mb-4">Customer Information</h3>
                <form id="checkout-form" class="space-y-4">
                    <div>
                        <label for="customer-name" class="block text-gray-700 text-lg mb-2">Full Name</label>
                        <input type="text" id="customer-name" class="w-full p-3 rounded-md bg-gray-100 border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="John Doe" required>
                    </div>
                    <div>
                        <label for="customer-email" class="block text-gray-700 text-lg mb-2">Email</label>
                        <input type="email" id="customer-email" class="w-full p-3 rounded-md bg-gray-100 border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="john.doe@example.com" required>
                    </div>
                    <div>
                        <label for="customer-address" class="block text-gray-700 text-lg mb-2">Delivery Address</label>
                        <textarea id="customer-address" rows="3" class="w-full p-3 rounded-md bg-gray-100 border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="123 Gym Rat Avenue, Apt 4B, Fitness City, FL 33101" required></textarea>
                    </div>
                    <div class="text-center mt-6">
                        <button type="submit" class="font-bebas text-2xl py-3 px-8 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300">Place Order</button>
                    </div>
                </form>
            </div>
        </section>

    </main>

    <footer class="text-center py-6 bg-white shadow-inner text-gray-600">
        <p>&copy; 2025 Bicep Guys. All Rights Reserved.</p>
    </footer>

    <!-- Combo/Sauce Modal -->
    <div id="combo-sauce-modal" class="modal-overlay section-hidden">
        <div class="modal-content">
            <h3 id="modal-title" class="font-bebas text-4xl gradient-text mb-6 text-center">Customize Your Meal</h3>
            <div id="modal-combo-step">
                <p class="text-gray-300 mb-4 text-center">Would you like to make this a combo?</p>
                <div class="flex justify-center gap-4 mb-6">
                    <button id="modal-combo-yes" class="font-bebas text-xl py-2 px-6 rounded-full bg-gray-700 text-white hover:bg-gray-600 transition-colors duration-300">Yes, Make it a Combo!</button>
                    <button id="modal-combo-no" class="font-bebas text-xl py-2 px-6 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 selected-btn">No Thanks, Just the Kebab</button>
                </div>
                <div id="combo-options-container" class="space-y-4 section-hidden">
                    <div class="mb-4">
                        <label class="font-bold text-gray-300 block mb-2">Choose Your Combo Item:</label>
                        <div class="flex flex-wrap gap-3">
                            <button class="combo-type-btn font-bebas text-lg py-2 px-4 rounded-full bg-gray-700 text-white hover:bg-gray-600 transition-colors duration-300 selected-btn" data-combo-select-type="shake">Protein Shake</button>
                            <button class="combo-type-btn font-bebas text-lg py-2 px-4 rounded-full bg-gray-700 text-white hover:bg-gray-600 transition-colors duration-300" data-combo-select-type="yogurt">Greek Yogurt</button>
                        </div>
                    </div>
                    <div id="modal-shake-selector" class="mb-4 flex items-center">
                        <label class="font-bold text-gray-300 block mb-2 mr-2">Select Your Protein Shake:</label>
                        <select id="modal-shake-select" class="flex-grow p-2 rounded-md bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500"></select>
                        <img id="modal-shake-image" src="" alt="Selected Shake" class="modal-image-preview ml-4 section-hidden">
                    </div>
                    <div id="modal-yogurt-selector" class="mb-4 flex items-center section-hidden">
                        <label class="font-bold text-gray-300 block mb-2 mr-2">Select Your Greek Yogurt:</label>
                        <select id="modal-yogurt-select" class="flex-grow p-2 rounded-md bg-gray-700 border border-gray-600 text-white focus:outline-none focus:ring-2 focus:ring-yellow-500"></select>
                        <img id="modal-yogurt-image" src="" alt="Selected Yogurt" class="modal-image-preview ml-4 section-hidden">
                    </div>
                </div>
            </div>

            <div id="modal-sauce-step" class="section-hidden">
                <p class="text-gray-300 mb-4 text-center">Select your sauces (First one free, then $1.50 each extra):</p>
                <div id="modal-sauce-options" class="grid grid-cols-2 gap-4">
                    <!-- Sauce checkboxes will be rendered here -->
                </div>
            </div>
            
            <div class="flex justify-between items-center mt-6">
                <button id="modal-back-btn" class="font-bebas text-xl py-2 px-6 rounded-full bg-gray-600 text-white hover:bg-gray-500 transition-colors duration-300 section-hidden">Back</button>
                <button id="modal-next-btn" class="font-bebas text-xl py-2 px-6 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300">Next</button>
                <button id="modal-add-final-btn" class="font-bebas text-xl py-2 px-6 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 section-hidden">Add Final Meal to Cart</button>
            </div>
        </div>
    </div>


    <script>
        // Macro data for base components (per serving)
        const baseSideMacros = { P: 8, C: 50, F: 2, Cal: 240 }; // Small cup of rice + bowl of power packed veggies

        const proteinMacros = {
            "Chicken": { "Mini Muscle": { P: 30, C: 0, F: 2, Cal: 120 }, "Gainz Grill": { P: 60, C: 0, F: 4, Cal: 240 }, "Bicep Beast": { P: 100, C: 0, F: 7, Cal: 400 } },
            "Steak": { "Mini Muscle": { P: 30, C: 0, F: 5, Cal: 160 }, "Gainz Grill": { P: 60, C: 0, F: 10, Cal: 320 }, "Bicep Beast": { P: 100, C: 0, F: 17, Cal: 530 } },
            "Lamb": { "Mini Muscle": { P: 30, C: 0, F: 7, Cal: 180 }, "Gainz Grill": { P: 60, C: 0, F: 14, Cal: 360 }, "Bicep Beast": { P: 100, C: 0, F: 23, Cal: 600 } },
            "Plant-Based": { "Mini Muscle": { P: 30, C: 5, F: 5, Cal: 200 }, "Gainz Grill": { P: 60, C: 10, F: 10, Cal: 400 }, "Bicep Beast": { P: 100, C: 17, F: 17, Cal: 650 } }
        };

        const menuData = {
            kebabs: [
                { id: 1, name: "Olympian Original", desc: "Classic Mediterranean: Garlic, oregano, lemon, olive oil marinade.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/olympian-original.png" },
                { id: 2, name: "Smoky Shredder", desc: "Smoky Chipotle-Lime: Chipotle peppers, lime zest, smoked paprika.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/smoky-shredder.png" },
                { id: 3, name: "Tandoori Titan", desc: "Yogurt, turmeric, ginger, garam masala.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/tandoori-titan.png" },
                { id: 4, name: "Seoul Surge", desc: "Korean BBQ Fire: Gochujang, sesame, scallion, honey glaze.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/seoul-surge.png" },
                { id: 5, name: "Zesty Zenith", desc: "Zesty Herb & Citrus: Parsley, cilantro, orange, lemon, chili flakes.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/zesty-zenith.png" },
                { id: 6, name: "Island Inferno", desc: "Spicy Jamaican Jerk: Allspice, thyme, Scotch bonnet, cinnamon.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/island-inferno.png" }, // Adjusted to include Plant-Based & Lamb
                { id: 7, name: "Golden Gains", desc: "Honey Mustard Crunch: Honey, Dijon, cracked pepper, toasted seeds.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/golden-gains.png" },
                { id: 8, name: "Garlic Gauntlet", desc: "Roasted garlic, parmesan, Italian herbs.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/garlic-gauntlet.png" },
                { id: 9, name: "Teriyaki Triumph", desc: "Teriyaki Ginger: Soy, ginger, pineapple, green onion.", proteins: ["Chicken", "Steak", "Lamb", "Plant-Based"], imageUrl: "images/teriyaki-triumph.png" },
                { id: 10, name: "Buffalo Beast", desc: "Buffalo Sriracha: Hot sauce, sriracha, celery seed, blue cheese drizzle.", proteins: ["Chicken"], imageUrl: "images/buffalo-beast.png" } // Buffalo typically chicken
            ],
            prices: {
                "Chicken": { "Mini Muscle": 10.99, "Gainz Grill": 14.99, "Bicep Beast": 18.99 },
                "Steak": { "Mini Muscle": 11.49, "Gainz Grill": 15.49, "Bicep Beast": 19.49 },
                "Lamb": { "Mini Muscle": 12.99, "Gainz Grill": 16.99, "Bicep Beast": 20.99 },
                "Plant-Based": { "Mini Muscle": 10.99, "Gainz Grill": 14.99, "Bicep Beast": 18.99 }
            },
            sauces: [
                { id: 1, name: "Gym God Garlic Dip", desc: "Creamy garlic-herb dip, rich in flavor, light on guilt.", price: 1.00, macros: { P: 1, C: 3, F: 0.5, Cal: 20 } },
                { id: 2, name: "Chipotle Powerhouse", desc: "Smoky chipotle with a tangy kick, perfect for adding a protein boost.", price: 1.00, macros: { P: 1, C: 4, F: 0.8, Cal: 25 } },
                { id: 3, name: "Cool Down Cucumber-Dill", desc: "Refreshing cucumber and fresh dill, ideal for balancing spicy flavors.", price: 0.75, macros: { P: 0.5, C: 2, F: 0.2, Cal: 15 } },
                { id: 4, name: "Sweet Gains Honey-Lime", desc: "A subtle blend of natural sweetness and zesty lime.", price: 0.75, macros: { P: 0.5, C: 5, F: 0.1, Cal: 25 } },
                { id: 5, name: "Spicy Flex Sriracha Swirl", desc: "A creamy, spicy swirl for those who like extra heat.", price: 1.00, macros: { P: 1, C: 4, F: 0.6, Cal: 22 } }
            ],
            proteinShakes: [
                { id: 100, name: "Bicep Guys Protein Shake", brand: "Bicep Guys", price: 5.50, desc: "Our signature blend for maximum recovery and growth!", imageUrl: "images/bicep-guys-shake.png", macros: { P: 50, C: 8, F: 1.5, Cal: 250 } }, // New Bicep Guys Shake
                { id: 101, name: "Fairlife Core Power Vanilla", brand: "Fairlife", price: 4.99, desc: "Classic vanilla, high protein, lactose-free.", imageUrl: "images/fairlife-vanilla.png", macros: { P: 42, C: 10, F: 2.5, Cal: 230 } },
                { id: 102, name: "Fairlife Core Power Chocolate", brand: "Fairlife", price: 4.99, desc: "Rich chocolate, high protein, lactose-free.", imageUrl: "images/fairlife-chocolate.png", macros: { P: 42, C: 12, F: 3, Cal: 250 } },
                { id: 103, name: "ON Gold Standard Strawberry", brand: "Optimum Nutrition", price: 4.75, desc: "Fruity and lean, post-workout fuel.", imageUrl: "images/on-strawberry.png", macros: { P: 24, C: 3, F: 1.5, Cal: 130 } }
            ],
            greekYogurts: [
                { id: 201, name: "Chobani Plain 0% Fat", brand: "Chobani", price: 2.50, desc: "Pure, high-protein, versatile.", imageUrl: "images/chobani-plain.png", macros: { P: 15, C: 10, F: 0, Cal: 100 } },
                { id: 202, name: "Chobani Mixed Berry", brand: "Chobani", price: 2.75, desc: "Fruity and flavorful, grab-and-go.", imageUrl: "images/chobani-berry.png", macros: { P: 12, C: 18, F: 0, Cal: 120 } }
            ],
            zeroSodas: [
                { id: 301, name: "Coca-Cola Zero Sugar", price: 2.25, desc: "Classic taste, zero sugar.", macros: { P: 0, C: 0, F: 0, Cal: 0 } },
                { id: 302, name: "Diet Pepsi", price: 2.25, desc: "Crisp and refreshing, diet choice.", macros: { P: 0, C: 0, F: 0, Cal: 0 } },
                { id: 303, name: "Sprite Zero Sugar", price: 2.25, desc: "Lemon-lime refreshment, zero sugar.", macros: { P: 0, C: 0, F: 0, Cal: 0 } }
            ],
            comboDiscounts: {
                "shake": 2.00, // Discount applied to shake price when part of combo
                "yogurt": 1.50  // Discount applied to yogurt price when part of combo
            },
            sauceExtraCharge: 1.50
        };

        let cart = [];
        let currentKebabForCustomization = null; // Store kebab info when modal opens
        let selectedComboItem = null; // Stores selected shake/yogurt in modal
        let selectedSauces = []; // Stores selected sauces in modal

        document.addEventListener('DOMContentLoaded', () => {
            const menuSection = document.getElementById('menu-section');
            const aboutSection = document.getElementById('about-section');
            const cartSection = document.getElementById('cart-section');
            const checkoutSection = document.getElementById('checkout-section');

            const navMenuBtn = document.getElementById('nav-menu');
            const navAboutBtn = document.getElementById('nav-about');
            const navCartBtn = document.getElementById('nav-cart');
            const cartCountSpan = document.getElementById('cart-count');

            const kebabGrid = document.getElementById('kebab-grid');
            const filterContainer = document.getElementById('filter-container');
            const sauceGridSides = document.getElementById('sauce-grid-sides');
            const shakeGrid = document.getElementById('shake-grid');
            const yogurtGrid = document.getElementById('yogurt-grid');
            const sodaGrid = document.getElementById('soda-grid');
            
            const cartItemsContainer = document.getElementById('cart-items-container');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const cartTotalSpan = document.getElementById('cart-total');
            const checkoutButton = document.getElementById('checkout-button');
            const clearCartButton = document.getElementById('clear-cart-button');
            const checkoutItemsDiv = document.getElementById('checkout-items');
            const checkoutTotalSummarySpan = document.getElementById('checkout-total-summary');
            const checkoutTotalPSpan = document.getElementById('checkout-total-p');
            const checkoutTotalCSpan = document.getElementById('checkout-total-c');
            const checkoutTotalFSpan = document.getElementById('checkout-total-f');
            const checkoutTotalCalSpan = document.getElementById('checkout-total-cal');
            const checkoutForm = document.getElementById('checkout-form');

            const comboSauceModal = document.getElementById('combo-sauce-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalComboStep = document.getElementById('modal-combo-step');
            const modalSauceStep = document.getElementById('modal-sauce-step');
            const modalComboYesBtn = document.getElementById('modal-combo-yes');
            const modalComboNoBtn = document.getElementById('modal-combo-no');
            const comboOptionsContainer = document.getElementById('combo-options-container');
            const modalShakeSelector = document.getElementById('modal-shake-selector');
            const modalYogurtSelector = document.getElementById('modal-yogurt-selector');
            const modalShakeSelect = document.getElementById('modal-shake-select');
            const modalYogurtSelect = document.getElementById('modal-yogurt-select');
            const modalShakeImage = document.getElementById('modal-shake-image');
            const modalYogurtImage = document.getElementById('modal-yogurt-image');
            const modalSauceOptions = document.getElementById('modal-sauce-options');
            const modalBackBtn = document.getElementById('modal-back-btn');
            const modalNextBtn = document.getElementById('modal-next-btn');
            const modalAddFinalBtn = document.getElementById('modal-add-final-btn');

            const allProteins = ["All", ...new Set(menuData.kebabs.flatMap(k => k.proteins))];

            function renderFilters() {
                filterContainer.innerHTML = allProteins.map(protein => `
                    <button class="filter-btn font-bebas text-xl tracking-wider py-2 px-5 rounded-md border-2 border-gray-300 text-gray-700 hover:bg-yellow-500 hover:text-black transition-colors duration-300 ${protein === 'All' ? 'selected-btn' : ''}" data-filter="${protein}">
                        ${protein}
                    </button>
                `).join('');
            }

            function renderKebabs(filter = 'All') {
                kebabGrid.innerHTML = '';
                const filteredKebabs = filter === 'All'
                    ? menuData.kebabs
                    : menuData.kebabs.filter(kebab => kebab.proteins.includes(filter));

                filteredKebabs.forEach(kebab => {
                    const firstProtein = kebab.proteins[0];
                    const firstSize = "Gainz Grill";
                    const initialPrice = menuData.prices[firstProtein]?.[firstSize]?.toFixed(2) || 'N/A';

                    const card = document.createElement('div');
                    card.className = 'kebab-card bg-card-light rounded-lg shadow-lg p-6 flex flex-col transition-all duration-300 group border';
                    card.dataset.kebabId = kebab.id;

                    card.innerHTML = `
                        <div class="kebab-image-wrapper relative w-full h-40 bg-gray-100 rounded-md overflow-hidden">
                            <img src="${kebab.imageUrl}" alt="${kebab.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-grow text-card-dark">
                            <h3 class="font-bebas text-3xl gradient-text">${kebab.name}</h3>
                            <p class="text-gray-600 mb-4 h-12">${kebab.desc}</p>

                            <div class="mb-4">
                                <label class="font-bold text-gray-700">Protein:</label>
                                <div class="flex flex-wrap gap-2 mt-2 protein-selector">
                                    ${kebab.proteins.map((p, index) => `<button class="kebab-btn flex-1 py-1 px-2 rounded border border-gray-300 text-gray-700 hover:bg-yellow-400 transition-colors ${index === 0 ? 'selected-btn' : ''}" data-protein="${p}">${p}</button>`).join('')}
                                </div>
                            </div>

                            <div class="mb-6">
                                <label class="font-bold text-gray-700">Size:</label>
                                <div class="flex flex-wrap gap-2 mt-2 size-selector">
                                    <button class="kebab-btn flex-1 py-1 px-2 rounded border border-gray-300 text-gray-700 hover:bg-yellow-400 transition-colors" data-size="Mini Muscle">30g Protein</button>
                                    <button class="kebab-btn flex-1 py-1 px-2 rounded border border-gray-300 text-gray-700 hover:bg-yellow-400 transition-colors selected-btn" data-size="Gainz Grill">60g Protein</button>
                                    <button class="kebab-btn flex-1 py-1 px-2 rounded border border-gray-300 text-gray-700 hover:bg-yellow-400 transition-colors" data-size="Bicep Beast">100g Protein</button>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-auto">
                            <span class="price-display font-bebas text-5xl text-gray-800">$${initialPrice}</span>
                            <button class="add-to-cart-btn font-bebas text-xl py-2 px-6 mt-4 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 w-full">Add to Cart</button>
                        </div>
                    `;
                    kebabGrid.appendChild(card);
                });
            }

            function renderSidesAndDrinks() {
                // Sauces
                sauceGridSides.innerHTML = menuData.sauces.map(sauce => `
                    <div class="bg-gray-100 rounded-lg p-4 text-center flex flex-col justify-between items-center border border-gray-200">
                        <h4 class="font-bebas text-2xl text-yellow-600">${sauce.name}</h4>
                        <p class="text-gray-700 text-sm mb-2 h-12">${sauce.desc}</p>
                        <p class="font-bold text-lg text-gray-800">$${sauce.price.toFixed(2)}</p>
                        <button class="add-side-to-cart-btn font-bebas text-lg py-1 px-4 mt-2 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 w-full" data-item-type="sauce" data-item-id="${sauce.id}" data-item-name="${sauce.name}" data-item-price="${sauce.price}">Add</button>
                    </div>
                `).join('');

                // Protein Shakes
                shakeGrid.innerHTML = menuData.proteinShakes.map(shake => `
                    <div class="bg-gray-100 rounded-lg p-4 flex flex-col justify-between items-center border border-gray-200">
                        <h4 class="font-bebas text-2xl text-yellow-600">${shake.name}</h4>
                        <p class="text-gray-700 text-sm mb-2">${shake.brand} - ${shake.desc}</p>
                        <p class="font-bold text-lg text-gray-800">$${shake.price.toFixed(2)}</p>
                        <button class="add-side-to-cart-btn font-bebas text-lg py-1 px-4 mt-2 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 w-full" data-item-type="shake" data-item-id="${shake.id}" data-item-name="${shake.name}" data-item-price="${shake.price}">Add</button>
                    </div>
                `).join('');

                // Greek Yogurts
                yogurtGrid.innerHTML = menuData.greekYogurts.map(yogurt => `
                    <div class="bg-gray-100 rounded-lg p-4 flex flex-col justify-between items-center border border-gray-200">
                        <h4 class="font-bebas text-2xl text-yellow-600">${yogurt.name}</h4>
                        <p class="text-gray-700 text-sm mb-2">${yogurt.brand} - ${yogurt.desc}</p>
                        <p class="font-bold text-lg text-gray-800">$${yogurt.price.toFixed(2)}</p>
                        <button class="add-side-to-cart-btn font-bebas text-lg py-1 px-4 mt-2 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 w-full" data-item-type="yogurt" data-item-id="${yogurt.id}" data-item-name="${yogurt.name}" data-item-price="${yogurt.price}">Add</button>
                    </div>
                `).join('');

                // Zero Sodas
                sodaGrid.innerHTML = menuData.zeroSodas.map(soda => `
                    <div class="bg-gray-100 rounded-lg p-4 flex flex-col justify-between items-center border border-gray-200">
                        <h4 class="font-bebas text-2xl text-yellow-600">${soda.name}</h4>
                        <p class="text-gray-700 text-sm mb-2">${soda.desc}</p>
                        <p class="font-bold text-lg text-gray-800">$${soda.price.toFixed(2)}</p>
                        <button class="add-side-to-cart-btn font-bebas text-lg py-1 px-4 mt-2 rounded-full bg-yellow-500 text-black hover:bg-yellow-400 transition-colors duration-300 w-full" data-item-type="soda" data-item-id="${soda.id}" data-item-name="${soda.name}" data-item-price="${soda.price}">Add</button>
                    </div>
                `).join('');
            }

            function updateCartCount() {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                cartCountSpan.textContent = totalItems;
            }

            function renderCart() {
                cartItemsContainer.innerHTML = '';
                let total = 0;

                if (cart.length === 0) {
                    emptyCartMessage.style.display = 'block';
                } else {
                    emptyCartMessage.style.display = 'none';
                    cart.forEach((item, index) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'flex justify-between items-center bg-gray-200 p-4 rounded-md text-gray-800';
                        itemElement.innerHTML = `
                            <div>
                                <h4 class="font-bold text-lg text-yellow-600">${item.quantity}x ${item.name}</h4>
                                <p class="text-gray-700 text-sm">${item.details || ''}</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="font-bold text-xl">$${(item.price * item.quantity).toFixed(2)}</span>
                                <button class="remove-from-cart-btn bg-red-600 text-white rounded-full w-8 h-8 flex items-center justify-center text-xl hover:bg-red-500 transition-colors duration-300" data-index="${index}">&times;</button>
                            </div>
                        `;
                        cartItemsContainer.appendChild(itemElement);
                        total += item.price * item.quantity;
                    });
                }
                cartTotalSpan.textContent = `$${total.toFixed(2)}`;
            }

            function getMacros(item) {
                let p = 0, c = 0, f = 0, cal = 0;

                if (item.type === 'kebab' || item.type === 'combo') { // Kebab or Combo starts with base kebab + sides
                    const kebabMacros = proteinMacros[item.kebabProtein]?.[item.kebabSize] || { P: 0, C: 0, F: 0, Cal: 0 };
                    p += kebabMacros.P + baseSideMacros.P;
                    c += kebabMacros.C + baseSideMacros.C;
                    f += kebabMacros.F + baseSideMacros.F;
                    cal += kebabMacros.Cal + baseSideMacros.Cal;

                    if (item.type === 'combo') {
                        if (item.comboItemType === 'shake') {
                            const shake = menuData.proteinShakes.find(s => s.id === item.comboItemId);
                            if (shake) {
                                p += shake.macros.P;
                                c += shake.macros.C;
                                f += shake.macros.F;
                                cal += shake.macros.Cal;
                            }
                        } else if (item.comboItemType === 'yogurt') {
                            const yogurt = menuData.greekYogurts.find(y => y.id === item.comboItemId);
                            if (yogurt) {
                                p += yogurt.macros.P;
                                c += yogurt.macros.C;
                                f += yogurt.macros.F;
                                cal += yogurt.macros.Cal;
                            }
                        }
                    }
                    // Add sauce macros from combo details (all sauces contribute macros)
                    item.comboSauces.forEach(sauceId => {
                        const sauce = menuData.sauces.find(s => s.id === sauceId);
                        if (sauce) {
                            p += sauce.macros.P;
                            c += sauce.macros.C;
                            f += sauce.macros.F;
                            cal += sauce.macros.Cal;
                        }
                    });

                } else if (item.type === 'shake') {
                    const shake = menuData.proteinShakes.find(s => s.id === item.id);
                    if (shake) {
                        p += shake.macros.P;
                        c += shake.macros.C;
                        f += shake.macros.F;
                        cal += shake.macros.Cal;
                    }
                } else if (item.type === 'yogurt') {
                    const yogurt = menuData.greekYogurts.find(y => y.id === item.id);
                    if (yogurt) {
                        p += yogurt.macros.P;
                        c += yogurt.macros.C;
                        f += yogurt.macros.F;
                        cal += yogurt.macros.Cal;
                    }
                } else if (item.type === 'soda') {
                    const soda = menuData.zeroSodas.find(s => s.id === item.id);
                    if (soda) { // Sodas are mostly 0s, but included for completeness
                        p += soda.macros.P;
                        c += soda.macros.C;
                        f += soda.macros.F;
                        cal += soda.macros.Cal;
                    }
                } else if (item.type === 'sauce') {
                    const sauce = menuData.sauces.find(s => s.id === item.id);
                    if (sauce) {
                        p += sauce.macros.P;
                        c += sauce.macros.C;
                        f += sauce.macros.F;
                        cal += sauce.macros.Cal;
                    }
                }

                return { P: p, C: c, F: f, Cal: cal };
            }

            function addToCart(item) {
                // For main kebabs and combos, we treat each customization as a unique item
                // For standalone sides, we can group them
                let existingItemIndex = -1;

                if (item.type === 'kebab' || item.type === 'combo') {
                    // Always add as new unique item if it's a kebab or combo, as customizations are complex
                    existingItemIndex = -1;
                } else {
                    // For simple sides (shake, yogurt, soda, sauce), check if identical item exists
                    existingItemIndex = cart.findIndex(cartItem => 
                        cartItem.id === item.id && cartItem.type === item.type
                    );
                }
                
                if (existingItemIndex > -1) {
                    cart[existingItemIndex].quantity++;
                } else {
                    cart.push({...item, quantity: 1});
                }
                updateCartCount();
                renderCart();
            }

            function removeFromCart(index) {
                cart.splice(index, 1);
                updateCartCount();
                renderCart();
            }

            function handleCheckout() {
                checkoutItemsDiv.innerHTML = '';
                let total = 0;
                let totalP = 0, totalC = 0, totalF = 0, totalCal = 0;

                if (cart.length === 0) {
                    checkoutItemsDiv.innerHTML = '<p class="text-center text-gray-600">Your cart is empty. Nothing to checkout!</p>';
                } else {
                    cart.forEach(item => {
                        const itemElement = document.createElement('p');
                        itemElement.className = 'flex justify-between text-gray-700';
                        const details = item.details ? ` (${item.details})` : '';
                        itemElement.innerHTML = `<span>${item.quantity}x ${item.name}${details}</span> <span>$${(item.price * item.quantity).toFixed(2)}</span>`;
                        checkoutItemsDiv.appendChild(itemElement);
                        
                        const itemMacros = getMacros(item);
                        totalP += itemMacros.P * item.quantity;
                        totalC += itemMacros.C * item.quantity;
                        totalF += itemMacros.F * item.quantity;
                        totalCal += itemMacros.Cal * item.quantity;
                        total += item.price * item.quantity;
                    });
                }
                checkoutTotalSummarySpan.textContent = `$${total.toFixed(2)}`;
                checkoutTotalPSpan.textContent = `${totalP.toFixed(0)}g`;
                checkoutTotalCSpan.textContent = `${totalC.toFixed(0)}g`;
                checkoutTotalFSpan.textContent = `${totalF.toFixed(0)}g`;
                checkoutTotalCalSpan.textContent = `${totalCal.toFixed(0)}`;
                showSection('checkout');
            }

            function placeOrder(event) {
                event.preventDefault();
                if (cart.length === 0) {
                    alert("Your cart is empty. Please add items before placing an order.");
                    return;
                }
                alert("Order placed successfully! Your gains are on the way!");
                cart = [];
                updateCartCount();
                renderCart();
                checkoutForm.reset();
                showSection('menu');
            }

            // Modal Management
            // currentKebabForCustomization, selectedComboItem, selectedSauces declared globally
            let currentModalStep = 1; // 1 for combo, 2 for sauce

            function showModalStep(step) {
                currentModalStep = step;
                modalComboStep.classList.add('section-hidden');
                modalSauceStep.classList.add('section-hidden');
                modalBackBtn.classList.add('section-hidden');
                modalNextBtn.classList.add('section-hidden');
                modalAddFinalBtn.classList.add('section-hidden');

                if (step === 1) { // Combo step
                    modalTitle.textContent = "Customize Your Meal";
                    modalComboStep.classList.remove('section-hidden');
                    modalNextBtn.classList.remove('section-hidden');
                    // Reset combo choice for new kebab
                    isComboSelected = false;
                    selectedComboItem = null;
                    modalComboNoBtn.classList.add('selected-btn');
                    modalComboYesBtn.classList.remove('selected-btn');
                    comboOptionsContainer.classList.add('section-hidden'); // Initially hidden

                    // Ensure combo type buttons are reset to default visual and selected combo item
                    document.querySelectorAll('.combo-type-btn').forEach((btn, index) => {
                        btn.classList.remove('selected-btn');
                        if (index === 0) btn.classList.add('selected-btn'); // Default to shake visually
                    });
                    modalShakeSelector.classList.remove('section-hidden'); // Show shake selector by default
                    modalYogurtSelector.classList.add('section-hidden');

                    // Set default selectedComboItem to first shake/yogurt if available
                    if (menuData.proteinShakes.length > 0) {
                        modalShakeSelect.value = menuData.proteinShakes[0].id;
                        modalShakeImage.src = menuData.proteinShakes[0].imageUrl || '';
                        modalShakeImage.classList.remove('section-hidden');
                        selectedComboItem = { type: 'shake', id: menuData.proteinShakes[0].id };
                    } else {
                         modalShakeImage.classList.add('section-hidden');
                    }
                    if (menuData.greekYogurts.length > 0) {
                        modalYogurtSelect.value = menuData.greekYogurts[0].id;
                        modalYogurtImage.src = menuData.greekYogurts[0].imageUrl || '';
                        modalYogurtImage.classList.remove('section-hidden');
                    } else {
                        modalYogurtImage.classList.add('section-hidden');
                    }
                    
                } else if (step === 2) { // Sauce step
                    modalTitle.textContent = "Choose Your Sauces";
                    modalSauceStep.classList.remove('section-hidden');
                    modalBackBtn.classList.remove('section-hidden');
                    modalAddFinalBtn.classList.remove('section-hidden');
                    renderSauceOptionsInModal();
                    // Pre-check previously selected sauces if any (from last time modal was open)
                    modalSauceOptions.querySelectorAll('.sauce-checkbox').forEach(checkbox => {
                        if (selectedSauces.includes(parseInt(checkbox.dataset.sauceId))) {
                            checkbox.checked = true;
                        }
                    });
                }
            }

            function resetModalFullState() {
                comboSauceModal.classList.add('section-hidden');
                currentKebabForCustomization = null;
                isComboSelected = false;
                selectedComboItem = null;
                selectedSauces = [];
                currentModalStep = 1; // Reset to first step for next time
            }

            function renderSauceOptionsInModal() {
                modalSauceOptions.innerHTML = menuData.sauces.map(sauce => `
                    <label class="flex items-center bg-gray-700 p-3 rounded-md cursor-pointer hover:bg-gray-600 transition-colors">
                        <input type="checkbox" class="sauce-checkbox form-checkbox h-5 w-5 text-yellow-500 rounded border-gray-500 focus:ring-yellow-500" data-sauce-id="${sauce.id}">
                        <span class="ml-2 text-white">${sauce.name} ($${sauce.price.toFixed(2)})</span>
                    </label>
                `).join('');

                modalSauceOptions.querySelectorAll('.sauce-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (event) => {
                        const sauceId = parseInt(event.target.dataset.sauceId);
                        if (event.target.checked) {
                            selectedSauces.push(sauceId);
                        } else {
                            selectedSauces = selectedSauces.filter(id => id !== sauceId);
                        }
                    });
                });
            }

            // Event Listeners
            kebabGrid.addEventListener('click', e => {
                const target = e.target;
                const card = target.closest('.kebab-card');

                if (!card || !target.classList.contains('add-to-cart-btn')) return;

                const kebabId = parseInt(card.dataset.kebabId);
                const selectedKebabData = menuData.kebabs.find(k => k.id === kebabId);
                const selectedProtein = card.querySelector('.protein-selector .selected-btn').dataset.protein;
                const selectedSize = card.querySelector('.size-selector .selected-btn').dataset.size;
                const price = menuData.prices[selectedProtein]?.[selectedSize];

                if (price === undefined) {
                    alert('Please select protein and size for your kebab before adding to cart.');
                    return;
                }

                currentKebabForCustomization = {
                    id: kebabId,
                    name: selectedKebabData.name,
                    protein: selectedProtein,
                    size: selectedSize,
                    price: price
                };
                
                resetModalFullState(); // Always reset state when opening for a new kebab
                comboSauceModal.classList.remove('section-hidden'); // Show the modal overlay
                showModalStep(1); // Start at the combo choice step
            });
            
            filterContainer.addEventListener('click', e => {
                const target = e.target;
                if (!target.classList.contains('filter-btn')) return;

                filterContainer.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('selected-btn'));
                target.classList.add('selected-btn');
                
                const filter = target.dataset.filter;
                renderKebabs(filter);
            });

            // Add Side/Drink to Cart (from dedicated section)
            document.addEventListener('click', e => {
                const target = e.target;
                if (target.classList.contains('add-side-to-cart-btn')) {
                    const itemType = target.dataset.itemType;
                    const itemName = target.dataset.itemName;
                    const itemId = parseInt(target.dataset.itemId);
                    const itemPrice = parseFloat(target.dataset.itemPrice);

                    let itemMacros = {P:0,C:0,F:0,Cal:0};
                    if (itemType === 'sauce') itemMacros = menuData.sauces.find(s => s.id === itemId).macros;
                    else if (itemType === 'shake') itemMacros = menuData.proteinShakes.find(s => s.id === itemId).macros;
                    else if (itemType === 'yogurt') itemMacros = menuData.greekYogurts.find(y => y.id === itemId).macros;
                    else if (itemType === 'soda') itemMacros = menuData.zeroSodas.find(s => s.id === itemId).macros;

                    addToCart({
                        id: `${itemType}-${itemId}`,
                        name: itemName,
                        price: itemPrice,
                        type: itemType,
                        details: itemType === 'soda' ? 'Zero Sugar' : (itemType === 'sauce' ? 'Extra Sauce' : 'Side'),
                        P: itemMacros.P, C: itemMacros.C, F: itemMacros.F, Cal: itemMacros.Cal
                    });
                }
            });

            cartItemsContainer.addEventListener('click', e => {
                if (e.target.classList.contains('remove-from-cart-btn')) {
                    const indexToRemove = parseInt(e.target.dataset.index);
                    removeFromCart(indexToRemove);
                }
            });

            checkoutButton.addEventListener('click', handleCheckout);
            clearCartButton.addEventListener('click', () => {
                cart = [];
                updateCartCount();
                renderCart();
                alert('Your cart has been cleared!');
            });
            checkoutForm.addEventListener('submit', placeOrder);

            function showSection(sectionId) {
                menuSection.classList.add('section-hidden');
                aboutSection.classList.add('section-hidden');
                cartSection.classList.add('section-hidden');
                checkoutSection.classList.add('section-hidden');

                navMenuBtn.classList.remove('selected-nav-button');
                navAboutBtn.classList.remove('selected-nav-button');
                navCartBtn.classList.remove('selected-nav-button');

                if (sectionId === 'menu') {
                    menuSection.classList.remove('section-hidden');
                    navMenuBtn.classList.add('selected-nav-button');
                } else if (sectionId === 'about') {
                    aboutSection.classList.remove('section-hidden');
                    navAboutBtn.classList.add('selected-nav-button');
                } else if (sectionId === 'cart') {
                    cartSection.classList.remove('section-hidden');
                    navCartBtn.classList.add('selected-nav-button');
                    renderCart();
                } else if (sectionId === 'checkout') {
                    checkoutSection.classList.remove('section-hidden');
                }
            }

            // Navigation button handlers
            navMenuBtn.addEventListener('click', () => showSection('menu'));
            navAboutBtn.addEventListener('click', () => showSection('about'));
            navCartBtn.addEventListener('click', () => showSection('cart'));

            // Modal Combo Step Logic
            modalComboYesBtn.addEventListener('click', () => {
                isComboSelected = true;
                modalComboYesBtn.classList.add('selected-btn');
                modalComboNoBtn.classList.remove('selected-btn');
                comboOptionsContainer.classList.remove('section-hidden');
                // Auto-select and show the default combo type (shake)
                const defaultComboTypeBtn = document.querySelector('#modal-combo-step .combo-type-btn[data-combo-select-type="shake"]');
                if (defaultComboTypeBtn) defaultComboTypeBtn.click(); // Simulate click to set visibility and selectedComboItem
            });

            modalComboNoBtn.addEventListener('click', () => {
                isComboSelected = false;
                selectedComboItem = null; // No combo item selected
                modalComboNoBtn.classList.add('selected-btn');
                modalComboYesBtn.classList.remove('selected-btn');
                comboOptionsContainer.classList.add('section-hidden');
                modalShakeSelector.classList.add('section-hidden'); // Hide selectors
                modalYogurtSelector.classList.add('section-hidden');
                modalShakeImage.classList.add('section-hidden');
                modalYogurtImage.classList.add('section-hidden');
            });

            document.querySelectorAll('.combo-type-btn').forEach(btn => {
                btn.addEventListener('click', (event) => {
                    document.querySelectorAll('.combo-type-btn').forEach(b => b.classList.remove('selected-btn'));
                    event.target.classList.add('selected-btn');
                    const type = event.target.dataset.comboSelectType;
                    modalShakeSelector.classList.add('section-hidden');
                    modalYogurtSelector.classList.add('section-hidden');
                    modalShakeImage.classList.add('section-hidden');
                    modalYogurtImage.classList.add('section-hidden');

                    if (type === 'shake') {
                        modalShakeSelector.classList.remove('section-hidden');
                        selectedComboItem = { type: 'shake', id: parseInt(modalShakeSelect.value) };
                        const shake = menuData.proteinShakes.find(s => s.id === selectedComboItem.id);
                        if (shake && shake.imageUrl) {
                            modalShakeImage.src = shake.imageUrl;
                            modalShakeImage.classList.remove('section-hidden');
                        } else {
                            modalShakeImage.classList.add('section-hidden');
                        }
                    } else if (type === 'yogurt') {
                        modalYogurtSelector.classList.remove('section-hidden');
                        selectedComboItem = { type: 'yogurt', id: parseInt(modalYogurtSelect.value) };
                        const yogurt = menuData.greekYogurts.find(y => y.id === selectedComboItem.id);
                        if (yogurt && yogurt.imageUrl) {
                            modalYogurtImage.src = yogurt.imageUrl;
                            modalYogurtImage.classList.remove('section-hidden');
                        } else {
                            modalYogurtImage.classList.add('section-hidden');
                        }
                    }
                });
            });

            modalShakeSelect.addEventListener('change', () => {
                selectedComboItem = { type: 'shake', id: parseInt(modalShakeSelect.value) };
                const shake = menuData.proteinShakes.find(s => s.id === selectedComboItem.id);
                if (shake && shake.imageUrl) {
                    modalShakeImage.src = shake.imageUrl;
                    modalShakeImage.classList.remove('section-hidden');
                } else {
                    modalShakeImage.classList.add('section-hidden');
                }
            });

            modalYogurtSelect.addEventListener('change', () => {
                selectedComboItem = { type: 'yogurt', id: parseInt(modalYogurtSelect.value) };
                const yogurt = menuData.greekYogurts.find(y => y.id === selectedComboItem.id);
                if (yogurt && yogurt.imageUrl) {
                    modalYogurtImage.src = yogurt.imageUrl;
                    modalYogurtImage.classList.remove('section-hidden');
                } else {
                    modalYogurtImage.classList.add('section-hidden');
                }
            });

            modalNextBtn.addEventListener('click', () => {
                showModalStep(currentModalStep + 1); // Advance step in modal
            });

            modalBackBtn.addEventListener('click', () => {
                showModalStep(currentModalStep - 1); // Go back a step in modal
            });

            modalAddFinalBtn.addEventListener('click', () => {
                let finalPrice = currentKebabForCustomization.price;
                let finalDetails = `${currentKebabForCustomization.protein}, ${currentKebabForCustomization.size}`;
                let finalName = currentKebabForCustomization.name;
                let finalType = 'kebab';
                let finalKebabProtein = currentKebabForCustomization.protein;
                let finalKebabSize = currentKebabForCustomization.size;
                let finalComboItemType = null;
                let finalComboItemId = null;
                let finalComboSauces = selectedSauces; // All selected sauces from modal

                // Calculate macros for the main kebab + base sides
                let itemP = proteinMacros[finalKebabProtein][finalKebabSize].P + baseSideMacros.P;
                let itemC = proteinMacros[finalKebabProtein][finalKebabSize].C + baseSideMacros.C;
                let itemF = proteinMacros[finalKebabProtein][finalKebabSize].F + baseSideMacros.F;
                let itemCal = proteinMacros[finalKebabProtein][finalKebabSize].Cal + baseSideMacros.Cal;


                if (isComboSelected && selectedComboItem) {
                    let comboItem = null;
                    if (selectedComboItem.type === 'shake') {
                        comboItem = menuData.proteinShakes.find(s => s.id === selectedComboItem.id);
                        if(comboItem) {
                            finalPrice += comboItem.price - menuData.comboDiscounts.shake;
                            finalDetails += ` + ${comboItem.name}`;
                            finalName = `${currentKebabForCustomization.name} Combo`;
                            finalType = 'combo';
                            finalComboItemType = 'shake';
                            finalComboItemId = comboItem.id;
                            itemP += comboItem.macros.P;
                            itemC += comboItem.macros.C;
                            itemF += comboItem.macros.F;
                            itemCal += comboItem.macros.Cal;
                        }
                    } else if (selectedComboItem.type === 'yogurt') {
                        comboItem = menuData.greekYogurts.find(y => y.id === selectedComboItem.id);
                        if(comboItem) {
                            finalPrice += comboItem.price - menuData.comboDiscounts.yogurt;
                            finalDetails += ` + ${comboItem.name}`;
                            finalName = `${currentKebabForCustomization.name} Combo`;
                            finalType = 'combo';
                            finalComboItemType = 'yogurt';
                            finalComboItemId = comboItem.id;
                            itemP += comboItem.macros.P;
                            itemC += comboItem.macros.C;
                            itemF += comboItem.macros.F;
                            itemCal += comboItem.macros.Cal;
                        }
                    }
                }

                // Calculate sauce cost: first one is free, subsequent are $1.50
                let sauceCost = 0;
                let sauceDetails = '';
                if (selectedSauces.length > 0) {
                    if (selectedSauces.length > 1) { // If more than one sauce, charge for extras
                        sauceCost = (selectedSauces.length - 1) * menuData.sauceExtraCharge;
                    }
                    const selectedSauceNames = selectedSauces.map(id => menuData.sauces.find(s => s.id === id)?.name);
                    sauceDetails = `Sauces: ${selectedSauceNames.join(', ')}`;

                    // Add macros for ALL selected sauces (including the free one)
                    selectedSauces.forEach(sauceId => {
                        const sauce = menuData.sauces.find(s => s.id === sauceId);
                        if (sauce) {
                            itemP += sauce.macros.P;
                            itemC += sauce.macros.C;
                            itemF += sauce.macros.F;
                            itemCal += sauce.macros.Cal;
                        }
                    });
                }
                finalPrice += sauceCost;
                if (sauceDetails) {
                    finalDetails += ` (${sauceDetails})`;
                }
                
                addToCart({
                    id: `custom-meal-${currentKebabForCustomization.id}-${finalKebabProtein}-${finalKebabSize}-${finalComboItemType}-${finalComboItemId}-${selectedSauces.join('-')}`,
                    name: finalName,
                    price: finalPrice,
                    type: finalType,
                    details: finalDetails,
                    kebabId: currentKebabForCustomization.id,
                    kebabProtein: finalKebabProtein,
                    kebabSize: finalKebabSize,
                    comboItemType: finalComboItemType,
                    comboItemId: finalComboItemId,
                    comboSauces: finalComboSauces, // Store sauce IDs for macro calculation
                    P: itemP, C: itemC, F: itemF, Cal: itemCal // Final calculated macros for this item
                });

                resetModalFullState(); // Close and reset modal
                showSection('cart'); // Redirect to cart page after adding
            });

            // Initial render and display
            renderFilters();
            renderKebabs();
            renderSidesAndDrinks();
            updateCartCount();
            showSection('menu'); // Ensure menu is shown by default
        });
    </script>
</body>
</html>
